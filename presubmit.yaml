# Cloud Build YAML to run all presubmit tasks
# Using a machine with 8 CPUs to speed up the builds.
steps:
  - name: docker
    script: |
      set -e
      # Find all directories that contain a file named `Dockerfile`
      # The colors-e2e directories are their own modules, so docker builds them using the directory
      # as the build context (since their go.mod and go.sum files are within that directory).
      # All other directories are part of one module.
      for dir in $(find . -type d -exec test -e '{}'/Dockerfile \; -print); do
        echo "BUILDING $dir"
        if [[ "$dir" == "./colors-e2e/colors-be" ]] || \
           [[ "$dir" == "./colors-e2e/colors-fd" ]]; then
          docker build $dir
        else
          docker build . -f "$dir/Dockerfile"
        fi
      done
options:
  machineType: 'E2_HIGHCPU_8'